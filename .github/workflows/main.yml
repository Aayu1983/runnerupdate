name: Weekly Windows Self-Hosted Runner Update

on:
  #schedule:
    # Every Sunday at 19:20 IST -> 13:50 UTC
    #- cron: '50 13 * * 0'
  workflow_dispatch: # Manual trigger capability

permissions:
  id-token: write
  contents: read

jobs:
  update-runner:
    name: Update Windows Self-Hosted Runner
    runs-on: [self-hosted, windows]
    
    steps:
      - name: Show Current Environment
        shell: powershell
        run: |
          Write-Host "OS Version: $([System.Environment]::OSVersion)"
          Write-Host "Runner Directory: C:\actions-runner"

      - name: Install & Check Windows Updates (Dry Run/Download)
        shell: powershell
        run: |
          if (-not (Get-Module -ListAvailable -Name PSWindowsUpdate)) {
              Install-Module PSWindowsUpdate -Force -Confirm:$false -SkipPublisherCheck
          }
          Import-Module PSWindowsUpdate
          # Downloads updates first to save time
          Get-WindowsUpdate -Download -AcceptAll -Install -AutoReboot

      - name: Update Runner Binary (Self-Update)
        shell: powershell
        run: |
          # GitHub Runners usually auto-update, but this forces a check
          cd C:\actions-runner
          .\config.cmd --version
          # Note: If the runner updates itself, it might restart the process.
